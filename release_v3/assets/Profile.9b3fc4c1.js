import{d as B,u as F,e as b,a3 as n,a as U,b6 as _,c0 as g,f as e,m as s,a2 as d,c1 as P,c2 as x,c3 as y,c4 as A,a0 as a,bc as f,bf as w,c5 as M,b0 as $,a_ as k,I as v,F as R,B as i,ai as H,ar as L,v as D,ao as W,W as G,bu as N,bd as V,n as j}from"./index.8bddcd24.js";import{b as q}from"./useTitle.29c2f64c.js";import{L as z}from"./index.b8821340.js";const E=r=>e(N,{get colorScheme(){return r.can?"success":"danger"},get children(){return r.children}}),Q=()=>{const r=B();q("manage.sidemenu.profile");const{to:u,searchParams:S}=F(),[c,C]=b(n().username),[h,I]=b(""),[m,T]=U(t=>_.post("/me/update",{username:t?n().username:c(),password:t?"":h(),github_id:n().github_id})),o=async t=>{const l=await T(t);V(l,()=>{g({...n(),username:c()}),t?u(""):(j.success(r("users.update_profile_success")),u(`/@login?redirect=${encodeURIComponent(location.pathname)}`))})},p=S.githubID;return p&&(g({...n(),github_id:Number(p)}),o(!0)),e(G,{w:"$full",spacing:"$4",alignItems:"start",get children(){return[e(s,{get when(){return!d.is_guest(n())},get fallback(){return[e(P,{status:"warning",flexDirection:{"@initial":"column","@lg":"row"},get children(){return[e(x,{mr:"$2_5"}),e(y,{mr:"$2_5",get children(){return r("users.guest-tips")}}),e(A,{get children(){return r("users.modify_nothing")}})]}}),e(a,{spacing:"$2",get children(){return[e(f,{get children(){return r("global.have_account")}}),e(f,{color:"$info9",as:z,get href(){return`/@login?redirect=${encodeURIComponent(location.pathname)}`},get children(){return r("global.go_login")}})]}})]},get children(){return[e(w,{get children(){return r("users.update_profile")}}),e(M,{gap:"$2",columns:{"@initial":1,"@md":2},get children(){return[e($,{get children(){return[e(k,{for:"username",get children(){return r("users.change_username")}}),e(v,{id:"username",get value(){return c()},onInput:t=>{C(t.currentTarget.value)}})]}}),e($,{get children(){return[e(k,{for:"password",get children(){return r("users.change_password")}}),e(v,{id:"password",type:"password",placeholder:"********",get value(){return h()},onInput:t=>{I(t.currentTarget.value)}}),e(R,{get children(){return r("users.change_password-tips")}})]}})]}}),e(a,{spacing:"$2",get children(){return[e(i,{get loading(){return m()},onClick:[o,!1],get children(){return r("global.save")}}),e(s,{get when(){return!n().otp},get children(){return e(i,{colorScheme:"accent",onClick:()=>{u("/@manage/2fa")},get children(){return r("users.enable_2fa")}})}})]}})]}}),e(s,{get when(){return H(()=>!!L("github_login_enabled"),!0)()&&!d.is_guest(n())},get children(){return[e(w,{get children(){return r("users.github_login")}}),e(a,{spacing:"$2",get children(){return e(s,{get when(){return n().github_id},get fallback(){return e(i,{onClick:()=>{window.location.href=_.getUri()+"/auth/github?callback_url="+window.location.href+"&method=get_github_id"},get children(){return r("users.connect_github")}})},get children(){return e(i,{colorScheme:"danger",get loading(){return m()},onClick:()=>{g({...n(),github_id:0}),o(!0)},get children(){return r("users.disconnect_github")}})}})}})]}}),e(a,{wrap:"wrap",gap:"$2",mt:"$2",get children(){return e(D,{each:W,children:(t,l)=>e(E,{get can(){return d.can(n(),l())},get children(){return r(`users.permissions.${t}`)}})})}})]}})};export{Q as default};
